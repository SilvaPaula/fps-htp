---
title: "fps_htp_mean"
author: "Paula Silva"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(asreml)
library(plotrix)
library(psych)
library(tidyverse)
```

```{r, include=FALSE}
## Function to extract Variances
getVariance = function(asr, comp){
	var = summary(asr)$varcomp
	idx = which(rownames(var)==comp)
	v = var$component[idx]
	print(paste("variance component", v))
	return(v)
}

reps=2 ## number of reps
trts=2 ## number of treatments
```

MODELS TO TEST:

1 - **orthomosaic** 
asr <- asreml(fixed = mean ~ 1 , random =  ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column), data=ortho) 

2 - **photo mean** 
asr <- asreml(fixed= mean ~ 1 , random = ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column), data=plot.mean)

3 - **photo subsampling** 
asr <- asreml(fixed = mean ~ 1, random =  ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column) + ~id(rep):(row):(column):(entry), data=photo) 

4 - **photo image** 
asr = asreml(fixed= mean ~ 1, random =  ~id(entry) + ~id(rep) + ~id(original_file), data=photo)

5 - **photo image + angle** 
asr = asreml(fixed= mean ~ 1 + h_degree, random =  ~id(entry) + ~id(rep) + ~id(original_file), data=photo)

## TRAIT: NDVI (only reduced models - Untreated)

```{r, warning=FALSE}
## Load plot table
setwd("~/Documents/PhD_KSU/PhD_Documments/POLAND_LAB/LAB_Papers/XWang et al, 2019/20190819/NDVI")
plot1 <- read.csv("plot_18BYD2.csv", header=TRUE, check.names=FALSE)
## convert variables to factors
plot1 <- plot1 %>%
  as.tibble() %>%
  mutate_at(vars(plot_id:treatment),as.factor)
plot1 <- plot1[,c(1:4,7,11)]
colnames(plot1) <- c("plot_id","row","column","entry","rep","trt")
```

### Model orthomosaic (single plot value)
```{r}
## 2018-03-30
setwd("~/Documents/PhD_KSU/PhD_Documments/POLAND_LAB/LAB_Papers/XWang et al, 2019/20190819/NDVI")
ortho1 <- read.csv("20180330_Ash_BYD2_NDVI_om.csv", header=TRUE, check.names=FALSE)
colnames(ortho1) <- tolower(colnames(ortho1))
ortho1 <- merge(plot1, ortho1, by='plot_id')

asr <- asreml(fixed = mode ~ 1 , random =  ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column), data=ortho1, maxit=100, subset=trt=='Untreated') 
summary(asr)$varcomp

Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h11 <- round(Vg/(Vg + Ve/reps),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed11 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, Vg, Ve, asr.pv)

## 2018-04-04
setwd("~/Documents/PhD_KSU/PhD_Documments/POLAND_LAB/LAB_Papers/XWang et al, 2019/20190819/NDVI")
ortho2 <- read.csv("20180404_Ash_BYD2_NDVI_om.csv", header=TRUE, check.names=FALSE)
colnames(ortho2) <- tolower(colnames(ortho2))
ortho2 <- merge(plot1, ortho2, by='plot_id')

asr <- asreml(fixed = mode ~ 1 , random =  ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column), data=ortho2, maxit=100, subset=trt=='Untreated') 
summary(asr)$varcomp

Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h12 <- round(Vg/(Vg + Ve/reps),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed12 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, Vg, Ve, asr.pv)

## 2018-04-12
setwd("~/Documents/PhD_KSU/PhD_Documments/POLAND_LAB/LAB_Papers/XWang et al, 2019/20190819/NDVI")
ortho3 <- read.csv("20180412_Ash_BYD2_NDVI_om.csv", header=TRUE, check.names=FALSE)
colnames(ortho3) <- tolower(colnames(ortho3))
ortho3 <- merge(plot1, ortho3, by='plot_id')

asr <- asreml(fixed = mode ~ 1 , random =  ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column), data=ortho3, maxit=100, subset=trt=='Untreated') 
summary(asr)$varcomp

Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h13 <- round(Vg/(Vg + Ve/reps),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed13 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, Vg, Ve, asr.pv)

## 2018-04-19
setwd("~/Documents/PhD_KSU/PhD_Documments/POLAND_LAB/LAB_Papers/XWang et al, 2019/20190819/NDVI")
ortho4 <- read.csv("20180419_Ash_BYD2_NDVI_om.csv", header=TRUE, check.names=FALSE)
colnames(ortho4) <- tolower(colnames(ortho4))
ortho4 <- merge(plot1, ortho4, by='plot_id')

asr <- asreml(fixed = mode ~ 1 , random =  ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column), data=ortho4, maxit=100, subset=trt=='Untreated') 
summary(asr)$varcomp

Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h14 <- round(Vg/(Vg + Ve/reps),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed14 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, Vg, Ve, asr.pv)

## 2018-04-23
setwd("~/Documents/PhD_KSU/PhD_Documments/POLAND_LAB/LAB_Papers/XWang et al, 2019/20190819/NDVI")
ortho5 <- read.csv("20180423_Ash_BYD2_NDVI_om.csv", header=TRUE, check.names=FALSE)
colnames(ortho5) <- tolower(colnames(ortho5))
ortho5 <- merge(plot1, ortho5, by='plot_id')

asr <- asreml(fixed = mode ~ 1 , random =  ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column), data=ortho5, maxit=100, subset=trt=='Untreated') 
summary(asr)$varcomp

Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h15 <- round(Vg/(Vg + Ve/reps),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed15 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, Vg, Ve, asr.pv)

## 2018-05-16
setwd("~/Documents/PhD_KSU/PhD_Documments/POLAND_LAB/LAB_Papers/XWang et al, 2019/20190819/NDVI")
ortho6 <- read.csv("20180516_Ash_BYD2_NDVI_om.csv", header=TRUE, check.names=FALSE)
colnames(ortho6) <- tolower(colnames(ortho6))
ortho6 <- merge(plot1, ortho6, by='plot_id')

asr <- asreml(fixed = mode ~ 1 , random =  ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column), data=ortho6, maxit=100, subset=trt=='Untreated') 
summary(asr)$varcomp

Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h16 <- round(Vg/(Vg + Ve/reps),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed16 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, Vg, Ve, asr.pv)
```

### Model photo mean (single plot value by averaging multiple values per plot)

```{r}
## 2018-03-30
setwd("~/Documents/PhD_KSU/PhD_Documments/POLAND_LAB/LAB_Papers/XWang et al, 2019/20190819/NDVI")
photo1 <- read.csv("20180330_Ash_BYD2_NDVI_or.csv", header=TRUE, check.names=FALSE)
colnames(photo1) <- tolower(colnames(photo1))
photo1 <- merge(plot1, photo1, by='plot_id', suffixes = c("", ".y"))
plot.mean1 <- aggregate(photo1$mode, list(photo1$plot_id), mean)
colnames(plot.mean1) <- c('plot_id', 'mode')
plot.mean1 <- merge(plot1, plot.mean1)

asr <- asreml(fixed= mode ~ 1 , random = ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column), data=plot.mean1, maxit=100, subset= trt=='Untreated')
summary(asr)$varcomp

Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h21 <- round(Vg/(Vg + Ve/reps),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed21 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, Vg, Ve, asr.pv)

## 2018-04-04
setwd("~/Documents/PhD_KSU/PhD_Documments/POLAND_LAB/LAB_Papers/XWang et al, 2019/20190819/NDVI")
photo2 <- read.csv("20180404_Ash_BYD2_NDVI_or.csv", header=TRUE, check.names=FALSE)
colnames(photo2) <- tolower(colnames(photo2))
photo2 <- merge(plot1, photo2, by='plot_id', suffixes = c("", ".y"))
plot.mean2 <- aggregate(photo2$mode, list(photo2$plot_id), mean)
colnames(plot.mean2) <- c('plot_id', 'mode')
plot.mean2 <- merge(plot1, plot.mean2)

asr <- asreml(fixed= mode ~ 1 , random = ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column), data=plot.mean2, maxit=100, subset= trt=='Untreated')
summary(asr)$varcomp

Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h22 <- round(Vg/(Vg + Ve/reps),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed22 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, Vg, Ve, asr.pv)

## 2018-04-12
setwd("~/Documents/PhD_KSU/PhD_Documments/POLAND_LAB/LAB_Papers/XWang et al, 2019/20190819/NDVI")
photo3 <- read.csv("20180412_Ash_BYD2_NDVI_or.csv", header=TRUE, check.names=FALSE)
colnames(photo3) <- tolower(colnames(photo3))
photo3 <- merge(plot1, photo3, by='plot_id', suffixes = c("", ".y"))
plot.mean3 <- aggregate(photo3$mode, list(photo3$plot_id), mean)
colnames(plot.mean3) <- c('plot_id', 'mode')
plot.mean3 <- merge(plot1, plot.mean3)

asr <- asreml(fixed= mode ~ 1 , random = ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column), data=plot.mean3, maxit=100, subset= trt=='Untreated')
summary(asr)$varcomp

Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h23 <- round(Vg/(Vg + Ve/reps),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed23 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, Vg, Ve, asr.pv)

## 2018-04-19
photo4 <- read.csv("20180419_Ash_BYD2_NDVI_or.csv", header=TRUE, check.names=FALSE)
colnames(photo4) <- tolower(colnames(photo4))
photo4 <- merge(plot1, photo4, by='plot_id', suffixes = c("", ".y"))
plot.mean4 <- aggregate(photo4$mode, list(photo4$plot_id), mean)
colnames(plot.mean4) <- c('plot_id', 'mode')
plot.mean4 <- merge(plot1, plot.mean4)

asr <- asreml(fixed= mode ~ 1 , random = ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column), data=plot.mean4, maxit=100, subset= trt=='Untreated')
summary(asr)$varcomp

Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h24 <- round(Vg/(Vg + Ve/reps),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed24 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, Vg, Ve, asr.pv)

## 2018-04-23
photo5 <- read.csv("20180423_Ash_BYD2_NDVI_or.csv", header=TRUE, check.names=FALSE)
colnames(photo5) <- tolower(colnames(photo5))
photo5 <- merge(plot1, photo5, by='plot_id', suffixes = c("", ".y"))
plot.mean5 <- aggregate(photo5$mode, list(photo5$plot_id), mean)
colnames(plot.mean5) <- c('plot_id', 'mode')
plot.mean5 <- merge(plot1, plot.mean5)

asr <- asreml(fixed= mode ~ 1 , random = ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column), data=plot.mean5, maxit=100, subset= trt=='Untreated')
summary(asr)$varcomp

Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h25 <- round(Vg/(Vg + Ve/reps),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed25 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, Vg, Ve, asr.pv)

## 2018-05-16
photo6 <- read.csv("20180516_Ash_BYD2_NDVI_or.csv", header=TRUE, check.names=FALSE)
colnames(photo6) <- tolower(colnames(photo6))
photo6 <- merge(plot1, photo6, by='plot_id', suffixes = c("", ".y"))
plot.mean6 <- aggregate(photo6$mode, list(photo6$plot_id), mean)
colnames(plot.mean6) <- c('plot_id', 'mode')
plot.mean6 <- merge(plot1, plot.mean6)

asr <- asreml(fixed= mode ~ 1 , random = ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column), data=plot.mean6, maxit=100, subset= trt=='Untreated')
summary(asr)$varcomp

Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h26 <- round(Vg/(Vg + Ve/reps),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed26 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, Vg, Ve, asr.pv)
```

### Model photo subsampling (multiple values per plot)

```{r}
## 2018-03-30
asr <- asreml(fixed = mode ~ 1, random =  ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column) + ~id(rep):(row):(column):(entry), data=photo1, maxit=100, subset= trt=='Untreated') 
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo1$plot_id))
Vg <- getVariance(asr, 'entry')
Vd <- getVariance(asr, 'rep:row:column:entry')
Ve <- getVariance(asr, 'units!R')
h31 <- round(Vg/(Vg + Vd/(reps) + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed31 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Vd, Ve, asr.pv)

## 2018-04-04
asr <- asreml(fixed = mode ~ 1, random =  ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column) + ~id(rep):(row):(column):(entry), data=photo2, maxit=100, subset= trt=='Untreated') 
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo2$plot_id))
Vg <- getVariance(asr, 'entry')
Vd <- getVariance(asr, 'rep:row:column:entry')
Ve <- getVariance(asr, 'units!R')
h32 <- round(Vg/(Vg + Vd/(reps) + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed32 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Vd, Ve, asr.pv)

## 2018-04-12
asr <- asreml(fixed = mode ~ 1, random =  ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column) + ~id(rep):(row):(column):(entry), data=photo3, maxit=100, subset= trt=='Untreated') 
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo3$plot_id))
Vg <- getVariance(asr, 'entry')
Vd <- getVariance(asr, 'rep:row:column:entry')
Ve <- getVariance(asr, 'units!R')
h33 <- round(Vg/(Vg + Vd/(reps) + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed33 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Vd, Ve, asr.pv)

## 2018-04-19
asr <- asreml(fixed = mode ~ 1, random =  ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column) + ~id(rep):(row):(column):(entry), data=photo4, maxit=100, subset= trt=='Untreated') 
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo4$plot_id))
Vg <- getVariance(asr, 'entry')
Vd <- getVariance(asr, 'rep:row:column:entry')
Ve <- getVariance(asr, 'units!R')
h34 <- round(Vg/(Vg + Vd/(reps) + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed34 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Vd, Ve, asr.pv)

## 2018-04-23
asr <- asreml(fixed = mode ~ 1, random =  ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column) + ~id(rep):(row):(column):(entry), data=photo5, maxit=100, subset= trt=='Untreated') 
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo5$plot_id))
Vg <- getVariance(asr, 'entry')
Vd <- getVariance(asr, 'rep:row:column:entry')
Ve <- getVariance(asr, 'units!R')
h35 <- round(Vg/(Vg + Vd/(reps) + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed35 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Vd, Ve, asr.pv)

## 2018-05-16
asr <- asreml(fixed = mode ~ 1, random =  ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column) + ~id(rep):(row):(column):(entry), data=photo6, maxit=100, subset= trt=='Untreated') 
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo6$plot_id))
Vg <- getVariance(asr, 'entry')
Vd <- getVariance(asr, 'rep:row:column:entry')
Ve <- getVariance(asr, 'units!R')
h36 <- round(Vg/(Vg + Vd/(reps) + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed36 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Vd, Ve, asr.pv)
```

### Model photo image (including the effect of image)

```{r}
## 2018-03-30
asr = asreml(fixed= mode ~ 1, random =  ~id(entry) + ~id(rep) + ~id(original_file), data=photo1, maxit=100, subset= trt=='Untreated')
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo1$plot_id))
Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h41 <- round(Vg/(Vg + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed41 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Ve, asr.pv)

## 2018-04-04
asr = asreml(fixed= mode ~ 1, random =  ~id(entry) + ~id(rep) + ~id(original_file), data=photo2, maxit=100, subset= trt=='Untreated')
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo2$plot_id))
Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h42 <- round(Vg/(Vg + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed42 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Ve, asr.pv)

## 2018-04-12
asr = asreml(fixed= mode ~ 1, random =  ~id(entry) + ~id(rep) + ~id(original_file), data=photo3, maxit=100, subset= trt=='Untreated')
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo3$plot_id))
Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h43 <- round(Vg/(Vg + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed43 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Ve, asr.pv)

## 2018-04-19
asr = asreml(fixed= mode ~ 1, random =  ~id(entry) + ~id(rep) + ~id(original_file), data=photo4, maxit=100, subset= trt=='Untreated')
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo4$plot_id))
Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h44 <- round(Vg/(Vg + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed44 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Ve, asr.pv)

## 2018-04-23
asr = asreml(fixed= mode ~ 1, random =  ~id(entry) + ~id(rep) + ~id(original_file), data=photo5, maxit=100, subset= trt=='Untreated')
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo5$plot_id))
Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h45 <- round(Vg/(Vg + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed45 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Ve, asr.pv)

## 2018-05-16
asr = asreml(fixed= mode ~ 1, random =  ~id(entry) + ~id(rep) + ~id(original_file), data=photo6, maxit=100, subset= trt=='Untreated')
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo6$plot_id))
Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h46 <- round(Vg/(Vg + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed46 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Ve, asr.pv)
```

### Model photo image + angle (including the effect of image and camera angle)

```{r}
## 2018-03-30
asr = asreml(fixed= mode ~ 1 + h_degree, random =  ~id(entry) + ~id(rep) + ~id(original_file), data=photo1, maxit=100, subset= trt=='Untreated')
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo1$plot_id))
Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h51 <- round(Vg/(Vg + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed51 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Ve, asr.pv)

## 2018-04-04
asr = asreml(fixed= mode ~ 1 + h_degree, random =  ~id(entry) + ~id(rep) + ~id(original_file), data=photo2, maxit=100, subset= trt=='Untreated')
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo2$plot_id))
Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h52 <- round(Vg/(Vg + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed52 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Ve, asr.pv)

## 2018-04-12
asr = asreml(fixed= mode ~ 1 + h_degree, random =  ~id(entry) + ~id(rep) + ~id(original_file), data=photo3, maxit=100, subset= trt=='Untreated')
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo3$plot_id))
Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h53 <- round(Vg/(Vg + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed53 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Ve, asr.pv)

## 2018-04-19
asr = asreml(fixed= mode ~ 1 + h_degree, random =  ~id(entry) + ~id(rep) + ~id(original_file), data=photo4, maxit=100, subset= trt=='Untreated')
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo4$plot_id))
Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h54 <- round(Vg/(Vg + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed54 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Ve, asr.pv)

## 2018-04-23
asr = asreml(fixed= mode ~ 1 + h_degree, random =  ~id(entry) + ~id(rep) + ~id(original_file), data=photo5, maxit=100, subset= trt=='Untreated')
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo5$plot_id))
Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h55 <- round(Vg/(Vg + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed55 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Ve, asr.pv)

## 2018-05-16
asr = asreml(fixed= mode ~ 1 + h_degree, random =  ~id(entry) + ~id(rep) + ~id(original_file), data=photo6, maxit=100, subset= trt=='Untreated')
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo6$plot_id))
Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h56 <- round(Vg/(Vg + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed56 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Ve, asr.pv)
```

## TRAIT: NDVI (only reduced models - Treated)

### Model orthomosaic (single plot value)
```{r}
## 2018-03-30
asr <- asreml(fixed = mode ~ 1 , random =  ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column), data=ortho1, maxit=100, subset=trt=='Treated') 
summary(asr)$varcomp

Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h61 <- round(Vg/(Vg + Ve/reps),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed61 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, Vg, Ve, asr.pv)

## 2018-04-04
asr <- asreml(fixed = mode ~ 1 , random =  ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column), data=ortho2, maxit=100, subset=trt=='Treated') 
summary(asr)$varcomp

Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h62 <- round(Vg/(Vg + Ve/reps),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed62 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, Vg, Ve, asr.pv)

## 2018-04-12
asr <- asreml(fixed = mode ~ 1 , random =  ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column), data=ortho3, maxit=100, subset=trt=='Treated') 
summary(asr)$varcomp

Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h63 <- round(Vg/(Vg + Ve/reps),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed63 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, Vg, Ve, asr.pv)

## 2018-04-19
asr <- asreml(fixed = mode ~ 1 , random =  ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column), data=ortho4, maxit=100, subset=trt=='Treated') 
summary(asr)$varcomp

Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h64 <- round(Vg/(Vg + Ve/reps),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed64 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, Vg, Ve, asr.pv)

## 2018-04-23
asr <- asreml(fixed = mode ~ 1 , random =  ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column), data=ortho5, maxit=100, subset=trt=='Treated') 
summary(asr)$varcomp

Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h65 <- round(Vg/(Vg + Ve/reps),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed65 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, Vg, Ve, asr.pv)

## 2018-05-16
asr <- asreml(fixed = mode ~ 1 , random =  ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column), data=ortho6, maxit=100, subset=trt=='Treated') 
summary(asr)$varcomp

Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h66 <- round(Vg/(Vg + Ve/reps),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed66 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, Vg, Ve, asr.pv)
```

### Model photo mean (single plot value by averaging multiple values per plot)

```{r}
## 2018-03-30
asr <- asreml(fixed= mode ~ 1 , random = ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column), data=plot.mean1, maxit=100, subset= trt=='Treated')
summary(asr)$varcomp

Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h71 <- round(Vg/(Vg + Ve/reps),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed71 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, Vg, Ve, asr.pv)

## 2018-04-04
asr <- asreml(fixed= mode ~ 1 , random = ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column), data=plot.mean2, maxit=100, subset= trt=='Treated')
summary(asr)$varcomp

Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h72 <- round(Vg/(Vg + Ve/reps),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed72 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, Vg, Ve, asr.pv)

## 2018-04-12
asr <- asreml(fixed= mode ~ 1 , random = ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column), data=plot.mean3, maxit=100, subset= trt=='Treated')
summary(asr)$varcomp

Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h73 <- round(Vg/(Vg + Ve/reps),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed73 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, Vg, Ve, asr.pv)

## 2018-04-19
asr <- asreml(fixed= mode ~ 1 , random = ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column), data=plot.mean4, maxit=100, subset= trt=='Treated')
summary(asr)$varcomp

Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h74 <- round(Vg/(Vg + Ve/reps),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed74 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, Vg, Ve, asr.pv)

## 2018-04-23
asr <- asreml(fixed= mode ~ 1 , random = ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column), data=plot.mean5, maxit=100, subset= trt=='Treated')
summary(asr)$varcomp

Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h75 <- round(Vg/(Vg + Ve/reps),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed75 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, Vg, Ve, asr.pv)

## 2018-05-16
asr <- asreml(fixed= mode ~ 1 , random = ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column), data=plot.mean6, maxit=100, subset= trt=='Treated')
summary(asr)$varcomp

Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h76 <- round(Vg/(Vg + Ve/reps),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed76 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, Vg, Ve, asr.pv)
```

### Model photo subsampling (multiple values per plot)

```{r}
## 2018-03-30
asr <- asreml(fixed = mode ~ 1, random =  ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column) + ~id(rep):(row):(column):(entry), data=photo1, maxit=100, subset= trt=='Treated') 
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo1$plot_id))
Vg <- getVariance(asr, 'entry')
Vd <- getVariance(asr, 'rep:row:column:entry')
Ve <- getVariance(asr, 'units!R')
h81 <- round(Vg/(Vg + Vd/(reps) + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed81 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Vd, Ve, asr.pv)

## 2018-04-04
asr <- asreml(fixed = mode ~ 1, random =  ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column) + ~id(rep):(row):(column):(entry), data=photo2, maxit=100, subset= trt=='Treated') 
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo2$plot_id))
Vg <- getVariance(asr, 'entry')
Vd <- getVariance(asr, 'rep:row:column:entry')
Ve <- getVariance(asr, 'units!R')
h82 <- round(Vg/(Vg + Vd/(reps) + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed82 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Vd, Ve, asr.pv)

## 2018-04-12
asr <- asreml(fixed = mode ~ 1, random =  ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column) + ~id(rep):(row):(column):(entry), data=photo3, maxit=100, subset= trt=='Treated') 
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo3$plot_id))
Vg <- getVariance(asr, 'entry')
Vd <- getVariance(asr, 'rep:row:column:entry')
Ve <- getVariance(asr, 'units!R')
h83 <- round(Vg/(Vg + Vd/(reps) + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed83 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Vd, Ve, asr.pv)

## 2018-04-19
asr <- asreml(fixed = mode ~ 1, random =  ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column) + ~id(rep):(row):(column):(entry), data=photo4, maxit=100, subset= trt=='Treated') 
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo4$plot_id))
Vg <- getVariance(asr, 'entry')
Vd <- getVariance(asr, 'rep:row:column:entry')
Ve <- getVariance(asr, 'units!R')
h84 <- round(Vg/(Vg + Vd/(reps) + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed84 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Vd, Ve, asr.pv)

## 2018-04-23
asr <- asreml(fixed = mode ~ 1, random =  ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column) + ~id(rep):(row):(column):(entry), data=photo5, maxit=100, subset= trt=='Treated') 
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo5$plot_id))
Vg <- getVariance(asr, 'entry')
Vd <- getVariance(asr, 'rep:row:column:entry')
Ve <- getVariance(asr, 'units!R')
h85 <- round(Vg/(Vg + Vd/(reps) + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed85 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Vd, Ve, asr.pv)

## 2018-05-16
asr <- asreml(fixed = mode ~ 1, random =  ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column) + ~id(rep):(row):(column):(entry), data=photo6, maxit=100, subset= trt=='Treated') 
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo6$plot_id))
Vg <- getVariance(asr, 'entry')
Vd <- getVariance(asr, 'rep:row:column:entry')
Ve <- getVariance(asr, 'units!R')
h86 <- round(Vg/(Vg + Vd/(reps) + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed86 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Vd, Ve, asr.pv)
```

### Model photo image (including the effect of image)

```{r}
## 2018-03-30
asr = asreml(fixed= mode ~ 1, random =  ~id(entry) + ~id(rep) + ~id(original_file), data=photo1, maxit=100, subset= trt=='Treated')
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo1$plot_id))
Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h91 <- round(Vg/(Vg + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed91 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Ve, asr.pv)

## 2018-04-04
asr = asreml(fixed= mode ~ 1, random =  ~id(entry) + ~id(rep) + ~id(original_file), data=photo2, maxit=100, subset= trt=='Treated')
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo2$plot_id))
Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h92 <- round(Vg/(Vg + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed92 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Ve, asr.pv)

## 2018-04-12
asr = asreml(fixed= mode ~ 1, random =  ~id(entry) + ~id(rep) + ~id(original_file), data=photo3, maxit=60, subset= trt=='Treated')
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo3$plot_id))
Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h93 <- round(Vg/(Vg + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed93 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Ve, asr.pv)

## 2018-04-19
asr = asreml(fixed= mode ~ 1, random =  ~id(entry) + ~id(rep) + ~id(original_file), data=photo4, maxit=100, subset= trt=='Treated')
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo4$plot_id))
Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h94 <- round(Vg/(Vg + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed94 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Ve, asr.pv)

## 2018-04-23
asr = asreml(fixed= mode ~ 1, random =  ~id(entry) + ~id(rep) + ~id(original_file), data=photo5, maxit=100, subset= trt=='Treated')
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo5$plot_id))
Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h95 <- round(Vg/(Vg + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed95 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Ve, asr.pv)

## 2018-05-16
asr = asreml(fixed= mode ~ 1, random =  ~id(entry) + ~id(rep) + ~id(original_file), data=photo6, maxit=100, subset= trt=='Treated')
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo6$plot_id))
Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h96 <- round(Vg/(Vg + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed96 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Ve, asr.pv)
```

### Model photo image + angle (including the effect of image and camera angle)

```{r}
## 2018-03-30
asr = asreml(fixed= mode ~ 1 + h_degree, random =  ~id(entry) + ~id(rep) + ~id(original_file), data=photo1, maxit=100, subset= trt=='Treated')
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo1$plot_id))
Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h101 <- round(Vg/(Vg + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed101 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Ve, asr.pv)

## 2018-04-04
asr = asreml(fixed= mode ~ 1 + h_degree, random =  ~id(entry) + ~id(rep) + ~id(original_file), data=photo2, maxit=100, subset= trt=='Treated')
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo2$plot_id))
Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h102 <- round(Vg/(Vg + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed102 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Ve, asr.pv)

## 2018-04-12
asr = asreml(fixed= mode ~ 1 + h_degree, random =  ~id(entry) + ~id(rep) + ~id(original_file), data=photo3, maxit=100, subset= trt=='Treated')
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo3$plot_id))
Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h103 <- round(Vg/(Vg + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed103 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Ve, asr.pv)

## 2018-04-19
asr = asreml(fixed= mode ~ 1 + h_degree, random =  ~id(entry) + ~id(rep) + ~id(original_file), data=photo4, maxit=100, subset= trt=='Treated')
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo4$plot_id))
Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h104 <- round(Vg/(Vg + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed104 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Ve, asr.pv)

## 2018-04-23
asr = asreml(fixed= mode ~ 1 + h_degree, random =  ~id(entry) + ~id(rep) + ~id(original_file), data=photo5, maxit=100, subset= trt=='Treated')
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo5$plot_id))
Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h105 <- round(Vg/(Vg + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed105 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Ve, asr.pv)

## 2018-05-16
asr = asreml(fixed= mode ~ 1 + h_degree, random =  ~id(entry) + ~id(rep) + ~id(original_file), data=photo6, maxit=100, subset= trt=='Treated')
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo6$plot_id))
Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h106 <- round(Vg/(Vg + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed106 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Ve, asr.pv)
```

## TRAIT: CT

```{r, warning=FALSE}
## Load plot table
setwd("~/Documents/PhD_KSU/PhD_Documments/POLAND_LAB/LAB_Papers/XWang et al, 2019/20190819/CT")
plot3 <- read.csv("18MX_YT_1-60_plot_info.csv", header=TRUE, check.names=FALSE)
## convert variables to factors
plot3 <- plot3 %>%
  as.tibble() %>%
  mutate_at(vars(plot_id:icondition),as.factor)
plot3 <- plot3[,c(1,9,12:14)]
colnames(plot3) <- c("plot_id","rep","column","row","entry")
```

### Model orthomosaic (single plot value)

```{r}
## 2018-03-02
setwd("~/Documents/PhD_KSU/PhD_Documments/POLAND_LAB/LAB_Papers/XWang et al, 2019/20190819/CT")
ortho8 <- read.csv("20180302_18MX_YT_1-60_CT_om_by_plot.csv", header=TRUE, check.names=FALSE)
colnames(ortho8) <- tolower(colnames(ortho8))
ortho8 <- merge(plot3, ortho8, by='plot_id')
ortho8 <- ortho8 %>%
  as.tibble() %>%
  mutate_at(vars(median:mode),as.numeric)

asr <- asreml(fixed = mode ~ 1 , random =  ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column), data=ortho8, maxit=100) 
summary(asr)$varcomp

Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h211 <- round(Vg/(Vg + Ve/reps),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed211 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, Vg, Ve, asr.pv)

## 2018-03-19
ortho9 <- read.csv("20180319_18MX_YT_1-60_CT_om_by_plot.csv", header=TRUE, check.names=FALSE)
colnames(ortho9) <- tolower(colnames(ortho9))
ortho9 <- merge(plot3, ortho9, by='plot_id')
ortho9 <- ortho9 %>%
  as.tibble() %>%
  mutate_at(vars(median:mode),as.numeric)

asr <- asreml(fixed = mode ~ 1 , random =  ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column), data=ortho9, maxit=100) 
summary(asr)$varcomp

Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h212 <- round(Vg/(Vg + Ve/reps),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed212 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, Vg, Ve, asr.pv)
```

### Model photo mean (single plot value by averaging multiple values per plot)

```{r}
## 2018-03-02
setwd("~/Documents/PhD_KSU/PhD_Documments/POLAND_LAB/LAB_Papers/XWang et al, 2019/20190819/CT")
photo11 <- read.csv("20180302_18MX_YT_1-60_CT_or_by_plot.csv", header=TRUE, check.names=FALSE)
colnames(photo11) <- tolower(colnames(photo11))
photo11 <- merge(plot3, photo11, by='plot_id', suffixes = c("", ".y"))
plot.mean11 <- aggregate(photo11$mode, list(photo11$plot_id), mean)
colnames(plot.mean11) <- c('plot_id', 'mode')
plot.mean11 <- merge(plot3, plot.mean11)

asr <- asreml(fixed= mode ~ 1 , random = ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column), data=plot.mean11, maxit=100)
summary(asr)$varcomp

Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h221 <- round(Vg/(Vg + Ve/reps),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed221 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, Vg, Ve, asr.pv)

## 2018-03-19
photo12 <- read.csv("20180319_18MX_YT_1-60_CT_or_by_plot.csv", header=TRUE, check.names=FALSE)
colnames(photo12) <- tolower(colnames(photo12))
photo12 <- merge(plot3, photo12, by='plot_id', suffixes = c("", ".y"))
plot.mean12 <- aggregate(photo12$mode, list(photo12$plot_id), mean)
colnames(plot.mean12) <- c('plot_id', 'mode')
plot.mean12 <- merge(plot3, plot.mean12)

asr <- asreml(fixed= mode ~ 1 , random = ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column), data=plot.mean12, maxit=100)
summary(asr)$varcomp

Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h222 <- round(Vg/(Vg + Ve/reps),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed222 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, Vg, Ve, asr.pv)
```

### Model photo subsampling (multiple values per plot)

```{r}
## 2018-03-02
asr <- asreml(fixed = mode ~ 1, random =  ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column) + ~id(rep):(row):(column):(entry), data=photo11, maxit=100, pworkspace='500mb', workspace='5gb') 
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo11$plot_id))
Vg <- getVariance(asr, 'entry')
Vd <- getVariance(asr, 'rep:row:column:entry')
Ve <- getVariance(asr, 'units!R')
h231 <- round(Vg/(Vg + Vd/(reps) + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry',  pworkspace='5000mb', workspace='20gb')
avsed231 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Vd, Ve, asr.pv)

## 2018-03-19
asr <- asreml(fixed = mode ~ 1, random =  ~id(entry) + ~id(rep) + ~id(rep):(row) + ~id(rep):(column) + ~id(rep):(row):(column):(entry), data=photo12, maxit=100, pworkspace='500mb', workspace='5gb') 
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo12$plot_id))
Vg <- getVariance(asr, 'entry')
Vd <- getVariance(asr, 'rep:row:column:entry')
Ve <- getVariance(asr, 'units!R')
h232 <- round(Vg/(Vg + Vd/(reps) + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry',  pworkspace='5000mb', workspace='20gb')
avsed232 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Vd, Ve, asr.pv)
```

### Model photo image (including the effect of image)

```{r}
## 2018-03-02
asr = asreml(fixed= mode ~ 1, random =  ~id(entry) + ~id(rep) + ~id(original_file), data=photo11, maxit=100)
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo11$plot_id))
Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h241 <- round(Vg/(Vg + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed241 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Ve, asr.pv)

## 2018-03-19
asr = asreml(fixed= mode ~ 1, random =  ~id(entry) + ~id(rep) + ~id(original_file), data=photo12, maxit=100)
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo12$plot_id))
Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h242 <- round(Vg/(Vg + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed242 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Ve, asr.pv)
```

### Model photo image + angle (including the effect of image and camera angle)

```{r}
## 2018-03-02
asr = asreml(fixed= mode ~ 1 + h_degree, random =  ~id(entry) + ~id(rep) + ~id(original_file), data=photo11, maxit=100)
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo11$plot_id))
Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h251 <- round(Vg/(Vg + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed251 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Ve, asr.pv)

## 2018-03-19
asr = asreml(fixed= mode ~ 1 + h_degree, random =  ~id(entry) + ~id(rep) + ~id(original_file), data=photo12, maxit=100)
summary(asr)$varcomp

hm <- harmonic.mean(summary(photo12$plot_id))
Vg <- getVariance(asr, 'entry')
Ve <- getVariance(asr, 'units!R')
h252 <- round(Vg/(Vg + Ve/(reps*hm)),3) # heritability

asr.pv <- predict(asr,classify = 'entry')
avsed252 <- round(asr.pv$avsed,4) # ave. standard error of difference between the predicted means

rm(asr, hm, Vg, Ve, asr.pv)
```











